
# Information
```
Product     : CWP Control Web Panel
version     : 0.9.8.836
Fixed on    : 0.9.8.846
Test on     : CentOS7
Reference   : http://centos-webpanel.com/
CVE-Number  : CVE-2019-13359
```

<br>
# Description

The vulnerability allows low privilege users to escalate themself to become a root user by crafting a session file from testing environment and upload to the target server at /tmp directory

<br><br>

# State 1 Session prepareation (Testing Environment)
1. Check the current IP address of attacker



![](resources/cve-2019-13359.md/2019-07-06-11-27-02.png)



2. Set the IP address on testing environment network



![](resources/cve-2019-13359.md/2019-07-06-11-27-15.png)



3. Login as root on port 2031/2087 and save the cookie name from web browser (cwsrp-xxxxxxxxxxxxxxxxxxxxx)



![](resources/cve-2019-13359.md/2019-07-06-11-27-37.png)




4. Copy the content of session file (/tmp/sess_xxxxxxxxxxxxxx) to a new file "sess_123456"                  # we need "rkey"




![](resources/cve-2019-13359.md/2019-07-06-11-30-40.png)

<br>
"sess_123456"

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-31-02.png)

<br>
5. Save the token value from the session file (cwp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx)

```
cwp_24a7ebcfc91fc0817cc8961b115c8cd0
```

<br><br>

# State 2 Attack the target

6. Login as a normal user on port 2083 and upload file "sess_123456" to /tmp directory

<br>

Login

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-33-00.png)

<br>

Upload sess_123456 file

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-33-24.png)

<br>

Intercept the request

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-34-01.png)

<br>

Modify the parameter "fm_current_dir" value to "/tmp/"

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-34-35.png)

<br>

Upload successfully

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-34-55.png)

<br>

7. On another browser, replace the token value in the URL https://[target.com]:2031/cwp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/admin/index.php and create cookie name "cwsrp-xxxxxxxxxxxxxxxxxxxxx" and set its value to "123456" (sess_123456)

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-38-27.png)

<br>

8.  Open the URL and become the root user

<br>

Root panel

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-39-17.png)

<br>

Check the file sess_123456

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-40-00.png)

<br>

Web console

<br>

![](resources/cve-2019-13359.md/2019-07-06-11-48-39.png)

<br>

*From step 6 - 8 need doing it quickly. if we do it too slow, the application will change the permission of file sess_123456 to 600 and the file will become 0 byte. If this happened, attacker need to change session file name and repeat the steps again

<br><br>

# Discovered by
```
Pongtorn Angsuchotmetee, Nissana Sirijirakal, Narin Boonwasanarak
```